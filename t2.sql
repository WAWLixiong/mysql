-- ================================================

insert into m values(8, 8, 8); -- 不阻塞



-- --------------------------------------------------


insert into t values(8, 8, 8); -- 阻塞


-- --------------------------------------------------
-- ================================================

-- 非唯一索引等值锁 ================================================


update m set d=d+1 where id = 5; -- 不阻塞






-- --------------------------------------------------


update t set d=d+1 where id = 5; -- 不阻塞






-- 非唯一索引等值锁 ================================================
-- 主键索引范围锁 ================================================


insert into m values(8, 8, 8);  -- 不阻塞
insert into m values(13, 13, 13); -- 阻塞


-- --------------------------------------------------


insert into t values(8, 8, 8); -- 不阻塞
insert into t values(13, 13, 13); -- 阻塞


-- 主键索引范围锁 ================================================
-- 非唯一索引范围锁 ================================================


insert into m values(8, 8, 8); -- 阻塞


-- --------------------------------------------------


insert into t values(8, 8, 8); -- 阻塞


-- 非唯一索引范围锁 ================================================
-- 唯一索引范围锁 bug ================================================


update m set d=d+1 where id=20; -- 阻塞


-- --------------------------------------------------


update t set d=d+1 where id=20; -- 阻塞


-- 唯一索引范围锁 bug ================================================
-- 非唯一索引上存在"等值"的例子 ================================================



insert into m values(12, 12, 12); -- 阻塞


-- --------------------------------------------------



insert into t values(12, 12, 12); -- 阻塞


-- 非唯一索引上存在"等值"的例子 ================================================
-- limit 语句加锁 ================================================



insert into m values(12, 12, 12); -- 不阻塞

-- --------------------------------------------------



insert into t values(12, 12, 12); -- 不阻塞

-- limit 语句加锁 ================================================
-- 死锁的例子 ================================================


update m set d=d+1 where c=10;


-- --------------------------------------------------


update t set d=d+1 where c=10; -- 间隙锁与间隙锁不冲突


-- 死锁的例子 ================================================
